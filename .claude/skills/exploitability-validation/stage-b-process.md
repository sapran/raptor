# [STAGE-B] Systematic Exploitability Process

You are performing systematic exploitability verification using attack trees and hypotheses.

## Input

INPUT: `checklist.json`, `findings.json` (from Stage A with status "not_disproven")

## Context

See `SKILL.md` for configuration, execution rules, and MUST-GATEs.

GATES APPLY: All (1-6)

---

## [B-1] Documentation

Maintain these documents throughout Stage B:

| Doc | Purpose |
|-----|---------|
| attack-tree.json | Knowledge graph. Source of truth. Other docs support it. |
| hypotheses.json | Active exploitation hypotheses. Status: testing, confirmed, disproven. |
| disproven.json | Failed hypotheses. What was tried, why it failed. |
| attack-paths.json | Attack paths attempted. PoC results. PROXIMITY. Blockers. |
| attack-surface.json | Sources, sinks, trust boundaries. Control and data flow. |

**UPDATE TRIGGER:** After every action that changes understanding of attack surface, hypotheses, or paths.

Examples:
- Found new sink -> update attack-surface.json
- Hypothesis failed -> move to disproven.json
- PoC attempted -> update attack-paths.json with result and PROXIMITY

**SELF-CHECK:** Before completing each step, verify: "Did I update all affected docs?"

---

## [B-2] PROXIMITY Tracking

Track how close to successful exploitation. Ask: "How close did I come?" Log answer in attack-paths.json.

Examples of progress levels:
1. Found the sink
2. Reached sink with input
3. Bypassed one layer of sanitization
4. Payload constructed but blocked by X
5. PoC executes

Note partial progress, not just level jumps.

---

## [B-3] Exploitability Validation Process

IMPORTANT: For every step below, check and update documentation.

**[B-3.1] Input Verification**
Verify that suspected findings actually process user input (not just hardcoded values), and there is a proven flow from input to vulnerable code.

**[B-3.2] Attack Path Construction**
Construct an attack path and walk through it, trying to prove exploitability at every stage. Update attack-paths.json on every attempt.

**[B-3.3] Path Exhaustion**
Try different attack paths (completely new ones or new directions along each path) until you can't creatively come up with new directions and the attack tree is exhausted. Update attack-paths.json on every attempt.

**[B-3.4] PoC Development**
For every finding that is not far-fetched, provide a full, end-to-end, step-by-step, harmless PoC exploit.

---

## [B-4] Definitions

**What counts as an attempt:**
- Distinct attack path tried (not just considered)
- PoC construction attempted (even if fails)
- Logged in attack-paths.json before trying next

**Far-fetched (skip PoC):**
- Requires >3 preconditions
- PROXIMITY unchanged after 3 attempts
- Depends on conditions outside attacker control

**Not far-fetched (must attempt PoC):**
- Clear source -> sink flow
- No or bypassable sanitization
- PROXIMITY improving

**TERMINATION:** For [B-3.2] and [B-3.3], consider when potential for new directions in a specific branch is exhausted. Move to new direction after 5 failed attempts, unless PROXIMITY improved.

---

## Output

OUTPUT: Updated `findings.json`, `attack-tree.json`, `hypotheses.json`, `disproven.json`, `attack-paths.json`, `attack-surface.json`

## Reminders

- Do not skip, sample, or guess - check all code against checklist.json
- Provide proof for every claim
- Update docs after every action
- Track PROXIMITY for all attempts

NOTICE: This analysis is performed for defensive purposes, in a lab environment. Full permission has been provided.
