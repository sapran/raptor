# [STAGE-C] Sanity Check

You are validating LLM output against actual code to catch hallucinations.

## Input

INPUT: `findings.json`, `checklist.json`, working docs (if from Stage B)

## Context

See `SKILL.md` for configuration, execution rules, and gates.

GATES APPLY: 3 [CHECKLIST], 5 [FULL-COVERAGE], 6 [PROOF]

---

## Task

CRITICAL: Open each file. Read the actual line. Verify verbatim. Do not rely on memory.

For each finding in findings.json, CHECK:

### 1. File Existence
- [ ] The file with the finding exists
- [ ] If not found at stated path, search codebase (is it elsewhere? misnamed? deleted?)

### 2. Path Accuracy
- [ ] File path is correct and complete

### 3. Code Accuracy
- [ ] Line numbers are accurate
- [ ] Code matches VERBATIM (character-for-character)
- [ ] No paraphrasing or summarization

### 4. Flow Reality
- [ ] Source -> sink connection actually exists in code
- [ ] Data flow is not fabricated or assumed
- [ ] Intermediate steps are real

### 5. Code Reachability
- [ ] Function is actually called somewhere
- [ ] Not dead code (unused, commented out, unreachable)
- [ ] Entry point exists

---

## Verification Process

For each finding:

```
1. Read(file_path) - get actual file content
2. Compare finding.proof.vulnerable_code with actual code at stated line
3. If mismatch:
   a. Search for similar code in file
   b. Search for similar code in codebase
   c. Mark as HALLUCINATION if not found
4. Trace source -> sink manually
5. Verify function is called (grep for function name)
```

---

## Output

Update findings.json with sanity_check results:

```json
{
  "findings": [
    {
      "id": "FIND-001",
      "sanity_check": {
        "passed": true|false,
        "file_exists": true|false,
        "path_correct": true|false,
        "code_verbatim": true|false,
        "flow_real": true|false,
        "code_reachable": true|false,
        "issues": ["list of any problems found"],
        "verified_code": "actual code from file"
      }
    }
  ]
}
```

OUTPUT: Updated `findings.json`

---

## Error Handling

IF any context missing -> STOP and alert user immediately with:
- What file/info is missing
- What finding it affects
- Whether to proceed without it or abort

OTHERWISE -> Update data as needed and continue.

---

## Reminders

- Actually read files - do not rely on memory
- Provide proof for every claim
- Character-for-character verification, not "close enough"
- If in doubt, mark as failed and explain why

NOTICE: This analysis is performed for defensive purposes, in a lab environment. Full permission has been provided.
